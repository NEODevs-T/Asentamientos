@page "/Impresion"
@inject NavigationManager NavigationManager
@inject IRangoData RangoData
@inject IMaestraData MaestaData

<PageTitle>Impresion de Asentamientos</PageTitle>
<h1>Impresion</h1>

<FiltroMaestras OnChangelineas="((int l) => this.idLinea = l)" OnChangeempresa="((int e) => this.idEmpresa = e)"/>

<br>

@if(idLinea != 0){
    <FiltrosAsentamientos idLinea="@idLinea" OnChangeClasificacion="((int idClasiVar) => this.idClasiVar = idClasiVar)" OnChangeProducto="((int idProducto) => this.idProducto = idProducto)" OnChangeSeccion="((int idSeccion) => this.idSeccion = idSeccion)"/>
}

@if(idClasiVar != 0 && idProducto != 0){
    <RadzenButton class="mt-4" ButtonType="ButtonType.Button" Variant="Variant.Outlined" Disabled="false" Text="Consultar" ButtonStyle="ButtonStyle.Success" Click=Consultar />
}

<br>
<br>

@if(band){

    <RadzenButton Variant="Variant.Outlined" Click=Impresion  Text="Impresión" ButtonStyle="ButtonStyle.Warning" />

    <br>
    <br>

    <RadzenDataGrid Class="table .rz-background-color-success" Data="@listaRango" TItem="Rango" AllowVirtualization="true"
                AllowSorting="true" AllowColumnResize=true GridLines="DataGridGridLines.Both">

                <Columns>
                    <RadzenDataGridColumn Width="3%" TItem="Rango" Title="#" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
                        <Template Context="data">
                            <RadzenText class="mb-0 tipografia">@(listaRango.IndexOf(data) + 1)</RadzenText>
                        </Template>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="Rango" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Property="IdVariableNavigation.IdSeccionNavigation.Snombre" Title="Sección" />
                    <RadzenDataGridColumn TItem="Rango" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Property="IdVariableNavigation.Vnombre" Title="Variable" />
                    <RadzenDataGridColumn TItem="Rango" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" Property="IdVariableNavigation.IdUnidadNavigation.Unombre" Title="Unidad" />
                    @if(idEmpresa != empresas.PAVECA){
                        <RadzenDataGridColumn TItem="Rango" Title="3er Turno" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
                            <Template Context="data">
                                <input type="text" style="width: 50%; height:30px" disabled=true> 
                            </Template>
                        </RadzenDataGridColumn>
                    }
                    <RadzenDataGridColumn TItem="Rango" Title="2do Turno" Filterable="false" Sortable="false" TextAlign="TextAlign.Center">
                        <Template Context="data">
                            <input type="text" style="width: 50%; height:30px" disabled=true> 
                        </Template>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="Rango" Title="1er Turno" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" >
                        <Template Context="data">
                            <input type="text" style="width: 50%; height:30px" disabled=true>
                        </Template>
                    </RadzenDataGridColumn>
                    <RadzenDataGridColumn TItem="Rango" Title="Observación" Filterable="false" Sortable="false" TextAlign="TextAlign.Center" >
                        <Template Context="data">

                        </Template>
                    </RadzenDataGridColumn>
                </Columns>
    </RadzenDataGrid>
}else if(isCargando){
    <Load/>
}

@code {

    public List<Rango> listaRango {get; set;} = new List<Rango>();
    public bool band  {get; set;} =  false;

    public bool isCargando  {get; set;} =  false;
    public bool isAsentamientosHoy {get; set;} =  false;
    public int idProducto {get; set;} = 0;
    public int idSeccion {get; set;} = 0;
    public int idClasiVar {get; set;} = 0;
    public int idLinea {get; set;} = 0;
    public int idEmpresa {get; set;} = 0;
    public (int PAVECA, int CHEMPRO, int PANASA, int PAINSA) empresas = (PAVECA: 1,CHEMPRO: 2, PANASA: 3,PAINSA: 4);

    public FiltrosRangoControlDTO  filtros = new FiltrosRangoControlDTO();
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(idClasiVar != 0 && idSeccion != 0 && idProducto != 0){
            band = false;
        }
    }
    private async Task Consultar()
    {
        isCargando = true;
        band = false;
        filtros = new FiltrosRangoControlDTO();
        filtros.master = await MaestaData.GetMaestraPorLinea(idLinea);
        filtros.producto = idProducto;
        filtros.seccion = idSeccion;
        filtros.tipo = idClasiVar;
        listaRango = await RangoData.GetRangoDeControl(filtros);
        band = true;
        isCargando = false;
    }

    private void Impresion(){
        NavigationManager.NavigateTo($"impresion/{idLinea}/{idProducto}/{idSeccion}/{idClasiVar}/{idEmpresa}");
    }
}